<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ù…Ù†ØµØ© Ø§Ù„ØªØ¬Ø§Ø±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 25px;
            text-align: center;
            position: relative;
        }
        .user-info {
            position: absolute;
            left: 20px;
            top: 20px;
            background: rgba(255,255,255,0.2);
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 14px;
        }
        .logout-btn {
            position: absolute;
            right: 20px;
            top: 20px;
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            text-decoration: none;
        }
        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }
        .tab {
            padding: 15px 30px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }
        .tab.active {
            border-bottom: 3px solid #27ae60;
            background: white;
            font-weight: bold;
        }
        .tab-content {
            display: none;
            padding: 30px;
        }
        .tab-content.active {
            display: block;
        }
        .form-group {
            margin-bottom: 25px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            color: #2c3e50;
            font-weight: 600;
        }
        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #27ae60;
            box-shadow: 0 0 0 3px rgba(39, 174, 96, 0.1);
        }
        .btn {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 16px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 5px;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.4);
        }
        .btn-ai {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        }
        .btn-export {
            background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
        }
        .btn-danger {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }
        .raw-input {
            height: 200px;
            font-family: 'Courier New', monospace;
        }
        .result-box {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border: 2px dashed #27ae60;
            margin-top: 20px;
        }
        .order-card {
            background: #e8f5e8;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            border-right: 4px solid #27ae60;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .stat-card {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .error-message {
            background: #fee;
            color: #c33;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            border: 1px solid #fcc;
        }
        .success-message {
            background: #efe;
            color: #363;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            border: 1px solid #cfc;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="user-info" id="userInfo">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
            <a href="#" class="logout-btn" onclick="logout()">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</a>
            <h1>ğŸ¤– Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„ØªØ§Ø¬Ø±</h1>
            <p>Ù†Ø¸Ø§Ù… Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</p>
        </div>

        <div class="tabs">
            <div class="tab active" onclick="switchTab('process')">âš¡ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</div>
            <div class="tab" onclick="switchTab('orders')">ğŸ“¦ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¬Ø§Ù‡Ø²Ø©</div>
            <div class="tab" onclick="switchTab('profile')">ğŸ‘¤ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</div>
        </div>

        <!-- ØªØ¨ÙˆÙŠØ¨ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª -->
        <div class="tab-content active" id="process-tab">
            <h2>Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø§Ù…</h2>
            <p>Ø§Ù„ØµÙ‚ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙƒÙ…Ø§ ØªØµÙ„ Ù…Ù† Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙˆØ³ÙŠÙ‚ÙˆÙ… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø¨Ù…Ø¹Ø§Ù„Ø¬ØªÙ‡Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</p>
            
            <div class="form-group">
                <label>Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø§Ù… Ù…Ù† Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</label>
                <textarea id="rawData" class="raw-input" placeholder="Ø§Ù„ØµÙ‚ Ù‡Ù†Ø§ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙƒÙ…Ø§ ØªØµÙ„ Ù…Ù† Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡...

Ø£Ù…Ø«Ù„Ø©:

https://www.instagram.com/esraa_esmail_26
Ø§Ø³Ø±Ø§Ø¡ Ø§Ø³Ù…Ø§Ø¹ÙŠÙ„
ÙƒÙ…Ø¨Ø§ÙˆÙ†Ø¯ Ø¬ÙˆÙ„Ù Ø³ÙŠØªÙ‰ Ø¨Ø¬ÙˆØ§Ø± ÙƒØ§Ø±ÙÙˆØ± Ø§Ù„Ø¹Ø¨ÙˆØ± Ù…Ù†Ø·Ù‚Ù‡ Ø§Ù„Ø³Ù†Ø¯Ø³ Ø¹Ù…Ø§Ø±Ù‡ Ø¬Ù¦ Ù…Ø¯Ø®Ù„Ù£ Ú¤ÙŠÙ„Ø§ Ù¨ Ø§Ø±Ø¶Ù‰ Ø´Ù…Ø§Ù„ Ø§Ù„Ø§Ø³Ù†Ø³ÙŠØ±
01157228515
Ø¬Ø§ÙƒÙŠØª Ø¨ÙŠØ¬ ÙØ±Ùˆ
315 Ø´Ø§Ù…Ù„ Ø§Ù„Ø´Ø­Ù†

https://www.instagram.com/hannahhanyahmed
Ø§Ù„Ø§Ø³Ù… : hana hany 
Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: Ù£Ù¤ Ø´Ø§Ø±Ø¹ Ø­Ø³Ù†ÙŠÙ† Ø¹Ø¨Ø¯ Ø§Ù„Ù‚Ø§Ø¯Ø± Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø³Ø§Ø¯Ø³Ø© Ù…Ø¯ÙŠÙ†Ø© Ù†ØµØ± 
Ø±Ù‚Ù…ÙŠÙ† : 01020012790
01011709105
ÙƒØ§Ø±Ø¯ÙŠ ØªØ±ÙŠÙƒÙˆ Ø¨ÙŠØ¬ 
310 Ø´Ø§Ù…Ù„ Ø§Ù„Ø´Ø­Ù†"></textarea>
            </div>

            <button class="btn btn-ai" onclick="processWithAI()">ğŸ§  Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</button>
            
            <div class="success-message" id="successMessage"></div>
            <div class="error-message" id="errorMessage"></div>
            
            <div class="result-box" id="processingResult" style="display: none;">
                <h3>ğŸ“‹ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©:</h3>
                <div id="processedOrders"></div>
                <button class="btn btn-export" onclick="exportProcessedOrders()">ğŸ“¥ ØªØµØ¯ÙŠØ± Ø§Ù„Ø·Ù„Ø¨Ø§Øª</button>
                <button class="btn" onclick="saveProcessedOrders()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</button>
            </div>
        </div>

        <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¬Ø§Ù‡Ø²Ø© -->
        <div class="tab-content" id="orders-tab">
            <h2>Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalOrders">0</div>
                    <div>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="todayOrders">0</div>
                    <div>Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙŠÙˆÙ…</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalRevenue">0</div>
                    <div>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</div>
                </div>
            </div>
            <div id="savedOrdersContainer">
                <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª...</p>
            </div>
        </div>

        <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ -->
        <div class="tab-content" id="profile-tab">
            <h2>Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</h2>
            <div id="profileInfo">
                <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</p>
            </div>
        </div>
    </div>

    <script>
        // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¯Ù† ÙˆØ§Ù„Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„ÙƒØ§Ù…Ù„Ø©
        const citiesData = {
            "Cairo": ["Abdin", "El Abaseya", "Al Azbakeya", "El Katameya", "Al Manial", "El Mokattam", "Dar El Salam", "El Basatin", "El-Gamaleya", "Al Sayeda Zeinab", "Helwan", "Maadi", "Masr El Qadima", "Qasr El Nil", "El Khalifa", "Torah", "Zamalek", "El Shorouk", "Badr City", "Ain Shams", "Madinaty", "Al Zaitoun", "Nasr City", "New Cairo", "Heliopolis", "Al Amiriyyah", "El Salam", "El Waily", "Al Sharabeya", "Al Marj", "Al Matariyyah", "El Nozha", "Hadaeq Al Qubbah", "Shobra", "Nile Corniche", "Cairo"],
            "Giza": ["6th of October City", "El Sheikh Zayed City", "Al Ayyat", "Al Hawamidiyya", "Badrshein", "El Saf", "Al Omraneya", "Atfih", "Bahariya Oasis", "Pyramids Gardens", "Faisal", "Haram", "Abu an Numros", "Al Agouzah", "Al Warak", "AwsÄ«m", "Boulaq Ad Dakrour", "Al Doqi", "Ard El Lewa", "Mohandessin", "Kirdasah", "Imbabah", "Monshaet El Kanater", "Giza"],
            "Alexandria": ["Ad Dakhilah", "Amreya", "Borg El Arab", "Moharam Bek", "Bab Sharqi", "Sidi Gabir", "Al Attarin", "Mansheya", "Al Labban", "El Gomrok", "Port al Basal", "Karmus", "Montaza 2", "Alexandria"],
            "Luxor": ["Luxor", "Armant", "Esna", "Al Qarnah"],
            "Aswan": ["Aswan", "Kom Ombo", "Daraw", "Edfu"],
            "Red Sea": ["Hurghada", "Ras Ghareb", "Safaga", "Quseer", "Marsa Alam"],
            "Assiut": ["Abnub", "Abu Tig", "Al Badari", "El Ghanayem", "El Fateh", "El Quseyya", "Dayrout", "Sahel Selim", "Sidfa", "Asyut", "Manfalut", "Manqabad"],
            "Sohag": ["Tima", "Tahta", "Juhaynah", "El Maragha", "Sohag", "Akhmim", "Saqultah", "Al Minshah", "Girga", "Al Balyana", "Dar El Salam", "El Usayrat"],
            "Qena": ["Qena", "Qus", "Madinet Qaft", "Dishna", "Naqadah", "Nagaa Hammadi", "Farshut", "Abu Tesht"],
            "Minya": ["El Idwa", "Maghagha", "Bani Mazar", "Matai", "Samalut", "Minya", "Abu Qurqas", "Mallawi", "Dayr Mawas"],
            "Beni Suef": ["Al Wasta", "Nasser", "Beni Suef", "Ihnasya Al Madinah", "Biba", "Sumusta El Waqf", "El Fashn"],
            "Fayoum": ["Tamiya", "Sinnuris", "Faiyum", "Atsa", "Ibsheway", "Youssef Al Seddik"],
            "Beheira": ["Damanhour", "Kafr El Dawar", "Abu Hummus", "El Mahmoudeya", "Natrn Valley", "Al Noubareya", "Abu Al Matamir", "Housh Eissa", "Itay Al Barud", "Shubrakhit", "Rosetta", "Idku", "Badr", "Ad Dilinjat", "AR Rahmaniyyah", "Kom Hamada"],
            "Kafr El Sheikh": ["Kafr El Shaikh", "Desouk", "Fowa", "Mutubas", "Baltim", "El Hamool", "Riyadh", "Biyala", "Qillin", "Sidi Salem"],
            "Gharbia": ["Kafr Az Zayyat", "El Mahalla El Kubra", "Samannoud", "Basyoun", "El Santa", "Zefta", "Kotoor", "Tanta"],
            "Dakahlia": ["Mansoura", "Aga", "Al Manzalah", "Belqas", "Dikirnis", "El Senbellawein", "Menyet El Nasr", "Mit Ghamr", "Shirbin", "Talkha"],
            "Sharqia": ["Bilbeis", "Inshas", "Awlad Saqr", "El Husseiniya", "Dyarb Negm", "Faqus", "Kafr Saqr", "Mashtul as Suq", "Minya Al Qamh", "El Salheya El Qadima", "El Salheya El Gadida", "Tanis", "10th of Ramadan City", "Zagazig"],
            "Qalyubia": ["Banha", "Al Khankah", "Al Obour City", "Al Qanatir Al Khayriyyah", "Shibin El Qanater", "Toukh", "Kafr Shukr", "Qalyub", "Shubra Al Khaymah"],
            "Menoufia": ["Quwaysna", "Birkat as SAB", "El Sadat City", "El Shohada", "Tala", "Shebeen El Kom", "El Bagour", "Menouf", "Ashmoun"],
            "Damietta": ["Faraskur", "Damietta", "New Damietta", "Kafr Saad", "El Zarqa", "Kafr Al Battikh", "Ras El Bar", "Izbat Al Burj"],
            "Port Said": ["Port Said"],
            "Matrouh": ["Marsa Matruh", "North Coast"],
            "New Valley": ["Kharga", "Dakhla", "Farafra"],
            "Ismailia": ["Ismailia"],
            "Suez": ["Suez"],
            "South Sinai": ["South Sinai Governorate", "Sharm El Sheikh", "Dahab"],
            "North Sinai": ["North Sinai"]
        };

        let currentMerchant = null;
        let processedOrders = [];

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„
        window.addEventListener('load', function() {
            checkAuth();
            loadMerchantData();
            loadSavedOrders();
        });

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
        function checkAuth() {
            currentMerchant = JSON.parse(localStorage.getItem('currentMerchant'));
            if (!currentMerchant) {
                window.location.href = 'login.html';
                return;
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ§Ø¬Ø±
        function loadMerchantData() {
            document.getElementById('userInfo').textContent = currentMerchant.storeName;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ
            document.getElementById('profileInfo').innerHTML = `
                <div class="order-card">
                    <h3>${currentMerchant.storeName}</h3>
                    <p><strong>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:</strong> ${currentMerchant.email}</p>
                    <p><strong>Ø§Ù„Ù‡Ø§ØªÙ:</strong> ${currentMerchant.phone}</p>
                    <p><strong>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</strong> ${currentMerchant.address}</p>
                    <p><strong>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©:</strong> ${getArabicCityName(currentMerchant.city)}</p>
                    <p><strong>Ø§Ù„Ù…Ù†Ø·Ù‚Ø©:</strong> ${currentMerchant.area}</p>
                    <p><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„:</strong> ${new Date(currentMerchant.registrationDate).toLocaleDateString('ar-EG')}</p>
                </div>
            `;
        }

        // ØªØ­ÙˆÙŠÙ„ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…Ø¯Ù† Ù„Ù„Ø¹Ø±Ø¨ÙŠØ©
        function getArabicCityName(englishName) {
            const cityMap = {
                'Cairo': 'Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©',
                'Giza': 'Ø§Ù„Ø¬ÙŠØ²Ø©', 
                'Alexandria': 'Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©',
                'Luxor': 'Ø§Ù„Ø£Ù‚ØµØ±',
                'Aswan': 'Ø£Ø³ÙˆØ§Ù†',
                'Red Sea': 'Ø§Ù„Ø¨Ø­Ø± Ø§Ù„Ø£Ø­Ù…Ø±',
                'Assiut': 'Ø£Ø³ÙŠÙˆØ·',
                'Sohag': 'Ø³ÙˆÙ‡Ø§Ø¬',
                'Qena': 'Ù‚Ù†Ø§',
                'Minya': 'Ø§Ù„Ù…Ù†ÙŠØ§',
                'Beni Suef': 'Ø¨Ù†ÙŠ Ø³ÙˆÙŠÙ',
                'Fayoum': 'Ø§Ù„ÙÙŠÙˆÙ…',
                'Beheira': 'Ø§Ù„Ø¨Ø­ÙŠØ±Ø©',
                'Kafr El Sheikh': 'ÙƒÙØ± Ø§Ù„Ø´ÙŠØ®',
                'Gharbia': 'Ø§Ù„ØºØ±Ø¨ÙŠØ©',
                'Dakahlia': 'Ø§Ù„Ø¯Ù‚Ù‡Ù„ÙŠØ©',
                'Sharqia': 'Ø§Ù„Ø´Ø±Ù‚ÙŠØ©',
                'Qalyubia': 'Ø§Ù„Ù‚Ù„ÙŠÙˆØ¨ÙŠØ©',
                'Menoufia': 'Ø§Ù„Ù…Ù†ÙˆÙÙŠØ©',
                'Damietta': 'Ø¯Ù…ÙŠØ§Ø·',
                'Port Said': 'Ø¨ÙˆØ±Ø³Ø¹ÙŠØ¯',
                'Matrouh': 'Ù…Ø·Ø±ÙˆØ­',
                'New Valley': 'Ø§Ù„ÙˆØ§Ø¯ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯',
                'Ismailia': 'Ø§Ù„Ø¥Ø³Ù…Ø§Ø¹ÙŠÙ„ÙŠØ©',
                'Suez': 'Ø§Ù„Ø³ÙˆÙŠØ³',
                'South Sinai': 'Ø¬Ù†ÙˆØ¨ Ø³ÙŠÙ†Ø§Ø¡',
                'North Sinai': 'Ø´Ù…Ø§Ù„ Ø³ÙŠÙ†Ø§Ø¡'
            };
            
            return cityMap[englishName] || englishName;
        }

        // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName + '-tab').classList.add('active');
        }

        // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø©
        function showMessage(elementId, message, isSuccess = true) {
            const messageElement = document.getElementById(elementId);
            messageElement.textContent = message;
            messageElement.style.display = 'block';
            messageElement.style.background = isSuccess ? '#efe' : '#fee';
            messageElement.style.color = isSuccess ? '#363' : '#c33';
            messageElement.style.borderColor = isSuccess ? '#cfc' : '#fcc';
            
            setTimeout(() => {
                messageElement.style.display = 'none';
            }, 5000);
        }

        // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù† Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
        function detectCityFromAddress(address) {
            const addressLower = address.toLowerCase();
            
            for (const [city, areas] of Object.entries(citiesData)) {
                // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©
                const arabicCityName = getArabicCityName(city).toLowerCase();
                if (addressLower.includes(arabicCityName)) {
                    return city;
                }
                
                // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚
                for (const area of areas) {
                    if (addressLower.includes(area.toLowerCase())) {
                        return city;
                    }
                }
            }
            
            return 'Cairo'; // Ø§ÙØªØ±Ø§Ø¶ÙŠ
        }

        // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù† Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
        function detectAreaFromAddress(address, city) {
            const addressLower = address.toLowerCase();
            const cityAreas = citiesData[city] || [];
            
            for (const area of cityAreas) {
                if (addressLower.includes(area.toLowerCase())) {
                    return area;
                }
            }
            
            return 'Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„';
        }

        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
        function processWithAI() {
            const rawData = document.getElementById('rawData').value.trim();
            
            if (!rawData) {
                showMessage('errorMessage', 'âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø§Ù…', false);
                return;
            }

            if (!currentMerchant) {
                showMessage('errorMessage', 'âš ï¸ ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹', false);
                return;
            }

            try {
                // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø§Ù…
                const orders = processRawData(rawData, currentMerchant);
                
                if (orders.length === 0) {
                    showMessage('errorMessage', 'âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø·Ù„Ø¨Ø§Øª ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¯Ø®Ù„Ø©', false);
                    return;
                }

                // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
                displayProcessedOrders(orders);
                document.getElementById('processingResult').style.display = 'block';
                showMessage('successMessage', `âœ… ØªÙ… Ù…Ø¹Ø§Ù„Ø¬Ø© ${orders.length} Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­`);
                
            } catch (error) {
                showMessage('errorMessage', 'âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ' + error.message, false);
            }
        }

        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø§Ù…
        function processRawData(rawData, sender) {
            const lines = rawData.split('\n').filter(line => line.trim());
            const orders = [];
            let currentOrder = {};
            let orderLines = [];

            // ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø·Ø± Ø§Ù„Ø®Ø§ØµØ© Ø¨ÙƒÙ„ Ø·Ù„Ø¨
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                
                if (line.includes('instagram.com') || line.includes('Ø§Ù†Ø³ØªØ¬Ø±Ø§Ù…') || i === lines.length - 1) {
                    // Ø¥Ø°Ø§ ÙˆØ¬Ø¯Ù†Ø§ Ø±Ø§Ø¨Ø· Ø§Ù†Ø³ØªØ¬Ø±Ø§Ù… Ø¬Ø¯ÙŠØ¯ Ø£Ùˆ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŒ Ù†Ø¹Ø§Ù„Ø¬ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø³Ø§Ø¨Ù‚
                    if (orderLines.length > 0) {
                        const order = processOrderLines(orderLines, sender);
                        if (order && order.receiverName && order.receiverPhone && order.receiverAddress) {
                            orders.push(order);
                        }
                        orderLines = [];
                    }
                }
                
                orderLines.push(line);
            }

            // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¢Ø®Ø± Ø·Ù„Ø¨
            if (orderLines.length > 0) {
                const order = processOrderLines(orderLines, sender);
                if (order && order.receiverName && order.receiverPhone && order.receiverAddress) {
                    orders.push(order);
                }
            }

            return orders;
        }

        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø£Ø³Ø·Ø± Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„ÙˆØ§Ø­Ø¯
        function processOrderLines(lines, sender) {
            const order = {
                senderName: sender.storeName,
                senderPhone: sender.phone,
                senderAddress: sender.address,
                senderCity: sender.city,
                senderArea: sender.area,
                timestamp: new Date().toISOString()
            };

            for (const line of lines) {
                // Ø§ÙƒØªØ´Ø§Ù Ø§Ù†Ø³ØªØ¬Ø±Ø§Ù…
                if (line.includes('instagram.com') && !order.instagram) {
                    order.instagram = line;
                }
                // Ø§ÙƒØªØ´Ø§Ù Ø§Ù„Ø§Ø³Ù… (ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù†Øµ Ø¨Ø¯ÙˆÙ† Ø£Ø±Ù‚Ø§Ù… ÙˆØ·ÙˆÙŠÙ„ enough)
                else if (!order.receiverName && line.length > 2 && line.length < 50 && !/\d/.test(line) && !line.includes('http') && !line.includes('@')) {
                    order.receiverName = line.replace('Ø§Ù„Ø§Ø³Ù…:', '').replace('Ø§Ù„Ø§Ø³Ù…', '').replace(':', '').trim();
                }
                // Ø§ÙƒØªØ´Ø§Ù Ø§Ù„Ø¹Ù†ÙˆØ§Ù† (ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø·ÙˆÙŠÙ„ ÙˆÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ ÙƒÙ„Ù…Ø§Øª Ø¯Ø§Ù„Ø©)
                else if (!order.receiverAddress && line.length > 10 && (line.includes('Ø´Ø§Ø±Ø¹') || line.includes('Ø­ÙŠ') || line.includes('Ù…Ù†Ø·Ù‚Ø©') || line.includes('Ù…Ø¯ÙŠÙ†Ø©') || line.includes('Ø¹Ù…Ø§Ø±Ø©') || line.includes('Ø¯ÙˆØ±') || line.includes('ÙƒÙ…Ø¨Ø§ÙˆÙ†Ø¯'))) {
                    order.receiverAddress = line.replace('Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:', '').replace('Ø§Ù„Ø¹Ù†ÙˆØ§Ù†', '').replace(':', '').trim();
                    
                    // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© ÙˆØ§Ù„Ù…Ù†Ø·Ù‚Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù† Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
                    if (order.receiverAddress) {
                        order.receiverCity = detectCityFromAddress(order.receiverAddress);
                        order.receiverArea = detectAreaFromAddress(order.receiverAddress, order.receiverCity);
                    }
                }
                // Ø§ÙƒØªØ´Ø§Ù Ø§Ù„Ù‡Ø§ØªÙ
                else if (!order.receiverPhone && /\d{10,}/.test(line)) {
                    const phones = line.match(/\d{10,}/g);
                    if (phones) {
                        order.receiverPhone = phones[0]; // Ù†Ø£Ø®Ø° Ø£ÙˆÙ„ Ø±Ù‚Ù… ÙÙ‚Ø·
                    }
                }
                // Ø§ÙƒØªØ´Ø§Ù Ø§Ù„Ù…Ù†ØªØ¬ ÙˆØ§Ù„Ø³Ø¹Ø±
                else if (!order.productName && line.length > 3 && (line.includes('Ø¬Ù†ÙŠÙ‡') || line.includes('Ø´Ø§Ù…Ù„') || line.includes('Ø´Ø­Ù†') || /\d+$/.test(line))) {
                    const productInfo = extractProductInfo(line);
                    if (productInfo.name && productInfo.price) {
                        order.productName = productInfo.name;
                        order.productPrice = productInfo.price;
                    }
                }
            }

            // Ø¥Ø°Ø§ Ù„Ù… Ù†Ø¬Ø¯ Ù…Ù†ØªØ¬ØŒ Ù†Ø³ØªØ®Ø¯Ù… ÙˆØµÙ Ø§ÙØªØ±Ø§Ø¶ÙŠ
            if (!order.productName) {
                order.productName = "Ù…Ù†ØªØ¬ Ù…Ù† " + sender.storeName;
                order.productPrice = "0";
            }

            return order;
        }

        // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬
        function extractProductInfo(text) {
            const priceMatch = text.match(/(\d+)/g);
            const price = priceMatch ? priceMatch[priceMatch.length - 1] : '0';
            
            // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù†Øµ Ù…Ù† Ø§Ù„Ø³Ø¹Ø± ÙˆØ§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©
            let name = text.replace(/\d+/g, '')
                          .replace('Ø´Ø§Ù…Ù„ Ø§Ù„Ø´Ø­Ù†', '')
                          .replace('Ø´Ø§Ù…Ù„', '')
                          .replace('Ø¬Ù†ÙŠÙ‡', '')
                          .replace('Ø´Ø­Ù†', '')
                          .trim();
            
            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø§Ø³Ù… Ù‚ØµÙŠØ± Ø¬Ø¯Ø§Ù‹ØŒ Ù†Ø³ØªØ®Ø¯Ù… ÙˆØµÙ Ø£ÙØ¶Ù„
            if (name.length < 3) {
                name = "Ù…Ù†ØªØ¬ Ù…Ù† Ø§Ù„Ù…ØªØ¬Ø±";
            }

            return { name, price };
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©
        function displayProcessedOrders(orders) {
            const container = document.getElementById('processedOrders');
            
            container.innerHTML = orders.map((order, index) => `
                <div class="order-card">
                    <h4>ğŸ›ï¸ Ø·Ù„Ø¨ ${index + 1}</h4>
                    <p><strong>Ø§Ù„Ø¹Ù…ÙŠÙ„:</strong> ${order.receiverName}</p>
                    <p><strong>Ø§Ù„Ù‡Ø§ØªÙ:</strong> ${order.receiverPhone}</p>
                    <p><strong>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</strong> ${order.receiverAddress}</p>
                    <p><strong>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©:</strong> ${getArabicCityName(order.receiverCity)}</p>
                    <p><strong>Ø§Ù„Ù…Ù†Ø·Ù‚Ø©:</strong> ${order.receiverArea}</p>
                    <p><strong>Ø§Ù„Ù…Ù†ØªØ¬:</strong> ${order.productName}</p>
                    <p><strong>Ø§Ù„Ø³Ø¹Ø±:</strong> ${order.productPrice} Ø¬Ù†ÙŠÙ‡</p>
                    ${order.instagram ? `<p><strong>Ø§Ù†Ø³ØªØ¬Ø±Ø§Ù…:</strong> ${order.instagram}</p>` : ''}
                    <p><strong>Ø§Ù„Ø±Ø§Ø³Ù„:</strong> ${order.senderName}</p>
                </div>
            `).join('');

            // Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ù…Ø¤Ù‚ØªØ§Ù‹
            processedOrders = orders;
        }

        // Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©
        function saveProcessedOrders() {
            if (processedOrders.length === 0) {
                showMessage('errorMessage', 'âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù„Ø­ÙØ¸Ù‡Ø§', false);
                return;
            }

            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© Ø³Ø§Ø¨Ù‚Ø§Ù‹
            const savedOrders = JSON.parse(localStorage.getItem(`merchant_orders_${currentMerchant.id}`)) || [];
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
            const newOrders = processedOrders.map(order => ({
                ...order,
                id: Date.now() + Math.random(),
                status: 'pending',
                merchantId: currentMerchant.id
            }));

            const allOrders = [...savedOrders, ...newOrders];
            localStorage.setItem(`merchant_orders_${currentMerchant.id}`, JSON.stringify(allOrders));

            showMessage('successMessage', `âœ… ØªÙ… Ø­ÙØ¸ ${newOrders.length} Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­`);
            loadSavedOrders();
            switchTab('orders');
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
        function loadSavedOrders() {
            const savedOrders = JSON.parse(localStorage.getItem(`merchant_orders_${currentMerchant.id}`)) || [];
            const container = document.getElementById('savedOrdersContainer');
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            document.getElementById('totalOrders').textContent = savedOrders.length;
            document.getElementById('todayOrders').textContent = savedOrders.filter(order => 
                new Date(order.timestamp).toDateString() === new Date().toDateString()
            ).length;
            
            const totalRevenue = savedOrders.reduce((sum, order) => sum + (parseInt(order.productPrice) || 0), 0);
            document.getElementById('totalRevenue').textContent = totalRevenue + ' Ø¬.Ù…';

            if (savedOrders.length === 0) {
                container.innerHTML = '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© Ø¨Ø¹Ø¯</p>';
                return;
            }

            container.innerHTML = savedOrders.map(order => `
                <div class="order-card">
                    <h4>${order.receiverName} - ${order.productName}</h4>
                    <p><strong>Ø§Ù„Ù‡Ø§ØªÙ:</strong> ${order.receiverPhone} | <strong>Ø§Ù„Ø³Ø¹Ø±:</strong> ${order.productPrice} Ø¬Ù†ÙŠÙ‡</p>
                    <p><strong>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</strong> ${order.receiverAddress}</p>
                    <p><strong>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©:</strong> ${getArabicCityName(order.receiverCity)} - <strong>Ø§Ù„Ù…Ù†Ø·Ù‚Ø©:</strong> ${order.receiverArea}</p>
                    <p><strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> ${new Date(order.timestamp).toLocaleDateString('ar-EG')}</p>
                    <button class="btn btn-danger" onclick="deleteOrder('${order.id}')" style="padding: 5px 10px; font-size: 12px;">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                </div>
            `).join('');
        }

        // Ø­Ø°Ù Ø·Ù„Ø¨
        function deleteOrder(orderId) {
            if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ØŸ')) return;

            const savedOrders = JSON.parse(localStorage.getItem(`merchant_orders_${currentMerchant.id}`)) || [];
            const filteredOrders = savedOrders.filter(order => order.id !== orderId);
            
            localStorage.setItem(`merchant_orders_${currentMerchant.id}`, JSON.stringify(filteredOrders));
            loadSavedOrders();
            showMessage('successMessage', 'âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­');
        }

        // ØªØµØ¯ÙŠØ± Ø§Ù„Ø·Ù„Ø¨Ø§Øª
        function exportProcessedOrders() {
            if (processedOrders.length === 0) {
                showMessage('errorMessage', 'âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±', false);
                return;
            }

            const finalOrders = processedOrders.map(order => ({
                so: "",
                goodsType: "Normal",
                goodsName: order.productName,
                quantity: "1",
                weight: "1", 
                cod: order.productPrice,
                insurePrice: "",
                allowOpen: "No",
                remark: `Ø§Ù†Ø³ØªØ¬Ø±Ø§Ù…: ${order.instagram || ''}`,
                
                senderName: order.senderName,
                senderTelephone: order.senderPhone,
                senderCity: order.senderCity,
                senderArea: order.senderArea,
                senderAddress: order.senderAddress,
                senderEmail: "",
                
                receiverName: order.receiverName,
                receiverTelephone: order.receiverPhone,
                receiverCity: order.receiverCity,
                receiverArea: order.receiverArea,
                receiverAddress: order.receiverAddress,
                receiverEmail: "",
                
                deliveryType: "Deliver",
                timestamp: order.timestamp
            }));

            let csv = 'S.O.,Goods type,Goods name,Quantity,Weight,COD,Insure price,Whether to allow the package to be opened,Remark,Name,Telephone,City,Area,Senders address,Sender Email,Name,Telephone,City,Area,Receivers address,Receiver Email,Delivery Type\n';
            
            finalOrders.forEach(order => {
                csv += `"${order.so}","${order.goodsType}","${order.goodsName}","${order.quantity}","${order.weight}","${order.cod}","${order.insurePrice}","${order.allowOpen}","${order.remark}","${order.senderName}","${order.senderTelephone}","${order.senderCity}","${order.senderArea}","${order.senderAddress}","${order.senderEmail}","${order.receiverName}","${order.receiverTelephone}","${order.receiverCity}","${order.receiverArea}","${order.receiverAddress}","${order.receiverEmail}","${order.deliveryType}"\n`;
            });

            const blob = new Blob(["\uFEFF" + csv], { type: 'text/csv; charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Ø·Ù„Ø¨Ø§Øª-${currentMerchant.storeName}-${new Date().toLocaleDateString('ar-EG')}.csv`;
            a.click();
            
            showMessage('successMessage', `âœ… ØªÙ… ØªØµØ¯ÙŠØ± ${finalOrders.length} Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­`);
        }

        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
        function logout() {
            if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ')) {
                localStorage.removeItem('currentMerchant');
                window.location.href = 'login.html';
            }
        }
    </script>
</body>
</html>
